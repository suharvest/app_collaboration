# Device Restore Configuration
# Factory firmware and restore operations for supported devices

version: "1.0"

devices:
  sensecap_watcher:
    name: "SenseCAP Watcher"
    name_zh: "SenseCAP Watcher"
    type: "watcher_dual_chip"
    description: "Restore ESP32 and Himax firmware via USB"
    description_zh: "通过 USB 烧录恢复 ESP32 和 Himax 出厂固件"

    # ESP32-S3 firmware (flashed first)
    esp32:
      name: "ESP32-S3 Firmware"
      name_zh: "ESP32-S3 固件"
      file: "esp32/factory_firmware.bin"
      flash_config:
        chip: "esp32s3"
        baud_rate: 921600
        flash_mode: "dio"
        flash_freq: "80m"
        flash_size: "16MB"
        address: "0x0"

    # Himax WE2 firmware (flashed after ESP32)
    himax:
      name: "Himax WE2 Firmware"
      name_zh: "Himax WE2 固件"
      file: "himax/himax_firmware_20240816.img"
      flash_config:
        baudrate: 921600
        timeout: 60

    detection:
      # WCH CH343 USB-Serial (shared by ESP32 and Himax)
      usb_vendor_id: "0x1a86"
      usb_product_id: "0x55d2"
      fallback_ports:
        - "/dev/cu.usbmodem*"
        - "/dev/tty.usbmodem*"
        - "/dev/ttyACM*"
        - "COM*"

  recamera:
    name: "reCamera"
    name_zh: "reCamera"
    type: "ssh_restore"
    description: "Restore by removing deployed packages and services"
    description_zh: "通过卸载已部署的包和服务进行还原"

    # Restore logic is implemented in Python (recamera_ssh.full_cleanup_and_restore)
    # using an exclusion/whitelist approach: factory system services are protected,
    # everything else is stopped, disabled, and removed.

    factory_paths:
      # These paths contain factory models - DO NOT DELETE
      protected:
        - "/userdata/Models/model.cvimodel"
        - "/userdata/MODEL/model.cvimodel"

      # These paths contain deployment-added content - CAN DELETE
      removable:
        - "/userdata/local/models/"

    default_credentials:
      username: "root"
      port: 22
