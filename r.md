————————————

Provisioning Station v1

需求说明（Deb 安装 + uv venv 随包）

————————————



一、目标



提供一个可本地安装的部署工具，把解决方案 Wiki (类似 https://wiki.seeedstudio.com/cn/solutions/smart-retail-voice-ai-solution-1/)中的部署流程，简化为：

选择方案 → 查看说明 → 按设备一键部署 → 查看最终结果。



当前实现方案 1（本地服务 + Web UI + deb 安装），并明确预留未来升级到 Tauri（方案 1.1）的路径，升级时不需要修改后端。



二、支持环境



支持 Raspberry Pi OS / Debian 系统，使用官方仓库源。

目标架构为 arm64。

系统需支持 systemd。



三、安装与交付方式



产品以单个 deb 安装包交付。



安装完成后必须满足以下行为：

系统中注册并启动一个 systemd 本地服务；

服务监听在 127.0.0.1 的固定端口；

系统桌面出现应用入口，点击后打开本地 Web 页面（浏览器或 Chromium app 模式均可）。



四、依赖与环境策略（核心）



系统级依赖（如 docker、ffmpeg、libopus 等）由 deb 的 Depends 机制通过 apt 安装。

Python 运行环境与第三方依赖由 uv 管理，创建的虚拟环境（venv）随 deb 一起打包，不依赖目标机器上的 pip 或 Python 包环境。

systemd 启动服务时必须使用该 venv 中的 Python 解释器。



五、安装后的目录与运行结构（固定）



应用安装到 /opt/provisioning-station 目录下。

该目录中包含后端代码、uv 创建的虚拟环境、前端静态资源、方案富文本内容以及运行时日志与数据目录。

应用运行过程中产生的日志与数据不得写入系统级目录。



六、整体用户流程



用户启动应用后，首先进入方案选择页面。

在方案选择页面中，用户选择需要部署的解决方案。



进入方案介绍页面后，页面展示：

方案的基本说明；

所需设备列表及推荐型号；

部署方式选择（外网方案 / 数据本地 / LLM 本地）。



用户确认部署方式后，点击进入部署文档页面。



七、部署文档页面（核心体验）



部署文档页面是一个“可执行的富文本文档”，外观类似 Wiki，但具备实际部署能力。



文档中按设备拆分为多个设备部署区块。

每个设备部署区块是独立的一键执行单元，不要求所有设备一起部署。



每个设备部署区块必须包含以下内容：

设备用途说明；

明确的连接或接线说明（USB、网线、IP 等）；

自动前置检查（如串口、网络、权限）；

一键部署按钮；

该设备的独立状态与实时日志。



八、支持的部署能力（v1）



支持三类部署能力：

本机 Docker 应用部署；

通过 USB 给 ESP32 烧录固件；

通过 SSH 在远程设备上执行部署命令或脚本。



每次点击一键部署都会生成一个设备级任务，该任务拥有独立的状态和日志。



九、任务与日志



每个设备任务的状态必须清晰展示，状态包括：未开始、执行中、成功、失败。

部署过程中需要提供实时日志展示，并将日志落盘保存，支持后续导出。



十、最终部署结果查看（必须）



在部署文档页面底部，提供方案级的最终结果查看区域。



该区域需要给用户一个明确、可理解的部署结果输出，例如：

服务是否启动成功；

设备是否连接正常；

关键接口或功能是否可用；

系统整体是否处于 READY 状态。



结果需要支持一键复制，用于交付确认或技术支持。



十一、安全与约束



后端服务仅监听本地地址，不对外网暴露。

所有涉及 Docker、串口、SSH 的高权限操作必须在后端完成。

串口类操作需要互斥，避免并发冲突。



十二、验收标准（Definition of Done）



deb 安装包可以在目标系统上直接安装；

systemd 服务启动正常，应用可通过桌面入口访问；

用户可以选择方案并进入部署文档；

每个设备可以独立一键部署并查看日志；

部署完成后有明确的 READY / FAILED 结果输出；

未来升级到 Tauri 时无需修改后端逻辑。