# Xiaozhi Remote Display Server
# Deployed to reComputer/Raspberry Pi for large screen display

services:
  xiaozhi-display:
    image: sensecraft-missionpack.seeed.cn/solution/xiaozhi-display:latest
    container_name: xiaozhi-display
    restart: unless-stopped

    # Network settings
    ports:
      - "8765:8765"
    network_mode: host  # Required for mDNS service discovery

    # Audio device passthrough (for HDMI/speaker output)
    devices:
      - /dev/snd:/dev/snd

    # Share PulseAudio/PipeWire socket for audio playback
    volumes:
      - /run/user/1000/pulse:/run/user/1000/pulse:ro

    # Environment configuration
    environment:
      # Device name shown in mDNS and Web UI
      - RD_DEVICE_NAME=${RD_DEVICE_NAME:-Xiaozhi Display}
      # Server port (default: 8765)
      - RD_PORT=${RD_PORT:-8765}
      # Disable audio (set to 1 if no audio output needed)
      - RD_NO_AUDIO=${RD_NO_AUDIO:-0}
      # PulseAudio server for audio output
      - PULSE_SERVER=unix:/run/user/1000/pulse/native
      # Timezone
      - TZ=${TZ:-Asia/Shanghai}

    # Container capabilities
    group_add:
      - audio  # Access to audio devices

    # Logging configuration
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8765/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
