version: "1.0"
id: recamera
name: reCamera YOLO26 Detector
name_zh: reCamera YOLO26 检测器
type: recamera_cpp

detection:
  method: network_scan
  manual_entry: true
  requirements: []

# SSH 连接配置（用户是 recamera，非 root）
ssh:
  port: 22
  default_user: recamera
  default_host: 192.168.42.1
  connection_timeout: 30
  command_timeout: 300

# C++ 应用部署配置
binary:
  # .deb 包安装（包含 init 脚本 S92yolo26-detector）
  deb_package:
    path: packages/yolo26-detector_0.1.1_riscv64.deb
    name: yolo26-detector
    includes_init_script: true

  # 模型文件部署
  models:
    - path: packages/yolo26n_cv181x_int8.cvimodel
      target_path: /userdata/local/models
      filename: yolo26n_cv181x_int8.cvimodel

  # 服务配置（deb 包已含 init 脚本）
  service_name: yolo26-detector
  service_priority: 92

  # MQTT 外部访问配置（启用外部 MQTT 访问以供预览使用）
  mqtt_config:
    enable: true
    port: 1883
    allow_anonymous: true

  # 冲突服务处理
  conflict_services:
    stop:
      - S03node-red
      - S91sscma-node
      - S93sscma-supervisor
      - S92yolo11-detector
    disable:
      - node-red
      - sscma-node
      - sscma-supervisor

  auto_start: true

# 用户输入
user_inputs:
  - id: host
    name: Device IP Address
    name_zh: 设备 IP 地址
    type: text
    default: "192.168.42.1"
    placeholder: "192.168.42.1"
    description: IP address of your reCamera (USB default 192.168.42.1)
    description_zh: reCamera 的 IP 地址（USB 默认 192.168.42.1）
    required: true
    validation:
      pattern: "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"

  - id: password
    name: SSH Password
    name_zh: SSH 密码
    type: password
    default: "recamera"
    description: SSH password (try 'recamera' or 'recamera.2')
    description_zh: SSH 密码（尝试 'recamera' 或 'recamera.2'）
    required: true

# 部署步骤
steps:
  - id: connect
    name: SSH Connect
    name_zh: SSH 连接
    description: Connect to reCamera via SSH as user 'recamera'
    description_zh: 以 recamera 用户通过 SSH 连接设备

  - id: prepare
    name: Stop Conflicting Services
    name_zh: 停止冲突服务
    description: Stop Node-RED, sscma-node, and supervisor
    description_zh: 停止 Node-RED、sscma-node 和 supervisor 服务

  - id: transfer
    name: Transfer Files
    name_zh: 传输文件
    description: Upload .deb package and model file via SCP
    description_zh: 通过 SCP 上传 deb 包和模型文件

  - id: install
    name: Install Package
    name_zh: 安装软件包
    description: Install deb package via opkg
    description_zh: 通过 opkg 安装 deb 软件包

  - id: models
    name: Deploy Model
    name_zh: 部署模型
    description: Copy model file to /userdata/local/models
    description_zh: 复制模型文件到 /userdata/local/models

  - id: mqtt
    name: Configure MQTT
    name_zh: 配置 MQTT
    description: Enable external MQTT access
    description_zh: 启用 MQTT 外部访问

  - id: disable
    name: Disable Conflicts
    name_zh: 禁用冲突服务
    description: Rename S* services to K* to prevent auto-start
    description_zh: 将 S* 服务重命名为 K* 防止自启动

  - id: start
    name: Start Service
    name_zh: 启动服务
    description: Start YOLO26 detector service
    description_zh: 启动 YOLO26 检测器服务

  - id: verify
    name: Verify
    name_zh: 验证
    description: Verify service is running
    description_zh: 验证服务正在运行

post_deployment:
  open_browser: false
