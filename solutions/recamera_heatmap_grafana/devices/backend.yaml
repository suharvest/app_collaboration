version: "1.0"
id: backend
name: InfluxDB + Grafana Backend
name_zh: InfluxDB + Grafana 后端

type: docker_local

detection:
  method: local
  requirements:
    - docker

docker:
  compose_file: ../docker/docker-compose.yml
  environment:
    DOCKER_INFLUXDB_INIT_USERNAME: admin
    DOCKER_INFLUXDB_INIT_PASSWORD: adminpassword
    DOCKER_INFLUXDB_INIT_ORG: seeed
    DOCKER_INFLUXDB_INIT_BUCKET: recamera
  options:
    project_name: recamera-heatmap
    remove_orphans: true
  services:
    - name: influxdb
      port: 8086
      health_check_endpoint: /health
      required: true
    - name: grafana
      port: 3000
      health_check_endpoint: /api/health
      required: true

pre_checks:
  - type: docker
    description: Docker must be installed and running
  - type: port_available
    ports:
      - 8086
      - 3000

post_deployment:
  open_browser: true
  url: http://localhost:3000
