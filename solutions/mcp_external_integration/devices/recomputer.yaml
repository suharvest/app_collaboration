version: "1.0"
id: recomputer
name: reComputer Host
name_zh: reComputer 主机
type: docker_local

detection:
  method: local
  requirements:
    - docker_installed
    - docker_running
    - docker_compose_installed

docker:
  compose_file: assets/docker/docker-compose.yml

  environment:
    DB_PATH: /opt/provisioning-station/data/warehouse
    INIT_MOCK_DATA: "false"
    ENABLE_SECURITY_HEADERS: "true"
    CORS_ORIGINS: "*"

  options:
    project_name: mcp_warehouse
    remove_orphans: true
    build: false

  services:
    - name: backend
      port: 2124
      health_check_endpoint: /api/dashboard/stats
      required: true
    - name: frontend
      port: 2125
      health_check_endpoint: /
      required: true

  images:
    - name: seeedstudio/warehouse-backend:latest
      required: true
    - name: seeedstudio/warehouse-frontend:latest
      required: true

pre_checks:
  - type: docker_version
    min_version: "20.0"
    description: Check Docker version
  - type: docker_compose_version
    min_version: "2.0"
    description: Check Docker Compose version
  - type: port_available
    ports:
      - 2124
      - 2125
    description: Check if ports are available
  - type: disk_space
    min_gb: 2
    description: Check available disk space

steps:
  - id: pull_images
    name: Pull Docker Images
    name_zh: 拉取Docker镜像
    description: Download required container images from registry
    description_zh: 从镜像仓库下载所需的容器镜像
    optional: false
    default: true

  - id: create_volumes
    name: Create Data Volumes
    name_zh: 创建数据卷
    description: Set up persistent storage for database
    description_zh: 设置数据库持久化存储
    optional: false
    default: true

  - id: start_services
    name: Start Services
    name_zh: 启动服务
    description: Launch Docker containers
    description_zh: 启动Docker容器
    optional: false
    default: true

  - id: health_check
    name: Health Check
    name_zh: 健康检查
    description: Verify all services are running correctly
    description_zh: 验证所有服务运行正常
    optional: false
    default: true

post_deployment:
  open_browser: true
  url: "http://localhost:2125"
