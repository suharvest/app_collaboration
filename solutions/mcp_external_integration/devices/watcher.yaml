version: "1.0"
id: watcher
name: SenseCAP Watcher
name_zh: SenseCAP Watcher
type: esp32_usb

detection:
  method: usb_serial
  # Watcher uses WCH USB-UART chip
  usb_vendor_id: "0x1a86"
  usb_product_id: "0x55d2"
  fallback_ports:
    - /dev/tty.wchusbserial*
    - /dev/cu.wchusbserial*
    - /dev/ttyUSB*
    - /dev/ttyACM*

firmware:
  source:
    type: local
    path: assets/watcher_firmware/firmware.bin

  flash_config:
    chip: esp32s3
    baud_rate: 921600
    flash_mode: dio
    flash_freq: 80m
    flash_size: 16MB
    partitions:
      - name: app
        offset: "0x10000"
        file: firmware.bin

pre_checks:
  - type: esptool_version
    min_version: "4.0"
    description: Check esptool is installed
  - type: port_available
    description: Check if serial port is accessible

steps:
  - id: detect
    name: Detect Device
    name_zh: 检测设备
    description: Scan USB ports for Watcher device
    description_zh: 扫描USB端口查找Watcher设备
    optional: false
    default: true

  - id: erase
    name: Erase Flash (Optional)
    name_zh: 擦除闪存 (可选)
    description: Erase flash memory before writing new firmware
    description_zh: 写入新固件前擦除闪存
    optional: true
    default: false

  - id: flash
    name: Flash Firmware
    name_zh: 烧录固件
    description: Write firmware to device flash memory
    description_zh: 将固件写入设备闪存
    optional: false
    default: true

  - id: verify
    name: Verify
    name_zh: 验证
    description: Verify firmware was written correctly
    description_zh: 验证固件写入正确
    optional: false
    default: true

post_deployment:
  reset_device: true
  wait_for_ready: 5
