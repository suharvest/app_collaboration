version: "1.0"
id: watcher_esp32
name: Xiaozhi ESP32 Firmware
name_zh: 小智 ESP32 固件
type: esp32_usb

detection:
  method: usb_serial
  # Watcher uses WCH USB-UART chip
  usb_vendor_id: "0x1a86"
  usb_product_id: "0x55d2"
  # Fallback patterns for different platforms
  fallback_ports:
    - "/dev/tty.wchusbserial*"
    - "/dev/cu.wchusbserial*"
    - "/dev/tty.usbserial-*"
    - "/dev/cu.usbserial-*"
    - "/dev/ttyUSB*"
    - "/dev/ttyACM*"

firmware:
  source:
    type: local
    path: assets/watcher_firmware/merged-binary.bin
  flash_config:
    chip: esp32s3
    baud_rate: 921600
    flash_mode: dio
    flash_freq: 80m
    flash_size: 16MB
    partitions:
      - name: merged_firmware
        offset: "0x0"
        file: merged-binary.bin

user_inputs:
  - id: serial_port
    name: Serial Port
    name_zh: 串口
    type: serial_port
    required: true
    description: Select the USB serial port (wchusbserial)
    description_zh: 选择 USB 串口（wchusbserial 开头）
    auto_detect: true

pre_checks:
  - type: serial_port_available
    description: Check if serial port is accessible
  - type: esptool_available
    description: Check if esptool is installed

post_deployment:
  reset_device: true
  wait_for_ready: 3
